<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.staoo.system.mapper.SystemNoticeMapper">
    <!-- 结果映射 -->
    <resultMap id="BaseResultMap" type="com.staoo.system.domain.SystemNotice">
        <id column="id" property="id" />
        <result column="tenant_id" property="tenantId" />
        <result column="title" property="title" />
        <result column="content" property="content" />
        <result column="type" property="type" />
        <result column="level" property="level" />
        <result column="status" property="status" />
        <result column="publish_time" property="publishTime" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
        <result column="create_by" property="createBy" />
        <result column="update_by" property="updateBy" />
        <result column="is_top" property="isTop" />
        <result column="read_status" property="readStatus" />
    </resultMap>

    <!-- 基础SQL片段 -->
    <sql id="Base_Column_List">
        id, tenant_id, title, content, type, level, status, publish_time,
        create_time, update_time, create_by, update_by, is_top, read_status
    </sql>

    <!-- 查询条件SQL片段 -->
    <sql id="Query_Condition">
        <where>
            <if test="id != null">
                AND id = #{id}
            </if>
            <if test="tenantId != null">
                AND tenant_id = #{tenantId}
            </if>
            <if test="title != null and title != ''">
                AND title LIKE CONCAT('%', #{title}, '%')
            </if>
            <if test="type != null">
                AND type = #{type}
            </if>
            <if test="level != null">
                AND level = #{level}
            </if>
            <if test="status != null">
                AND status = #{status}
            </if>
            <if test="readStatus != null">
                AND read_status = #{readStatus}
            </if>
            <if test="publishTime != null">
                AND publish_time = #{publishTime}
            </if>
            <if test="createTime != null">
                AND create_time = #{createTime}
            </if>
            <if test="updateTime != null">
                AND update_time = #{updateTime}
            </if>
            <if test="createBy != null">
                AND create_by = #{createBy}
            </if>
            <if test="updateBy != null">
                AND update_by = #{updateBy}
            </if>
        </where>
    </sql>

    <!-- 根据ID查询 -->
    <select id="selectById" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List" />
        FROM sys_notice
        WHERE id = #{id}
    </select>

    <!-- 查询列表 -->
    <select id="selectList" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List" />
        FROM sys_notice
        <include refid="Query_Condition" />
        ORDER BY create_time DESC
    </select>

    <!-- 查询总数 -->
    <select id="selectCount" resultType="java.lang.Long">
        SELECT COUNT(1)
        FROM sys_notice
        <include refid="Query_Condition" />
    </select>

    <!-- 新增 -->
    <insert id="insert" parameterType="com.staoo.system.domain.SystemNotice">
        INSERT INTO sys_notice (
            tenant_id, title, content, type, level, status,
            publish_time, create_time, update_time, create_by, update_by,
            is_top, read_status
        ) VALUES (
            #{tenantId}, #{title}, #{content}, #{type}, #{level}, #{status},
            #{publishTime}, #{createTime}, #{updateTime}, #{createBy}, #{updateBy},
            #{isTop}, #{readStatus}
        )
    </insert>

    <!-- 更新 -->
    <update id="update" parameterType="com.staoo.system.domain.SystemNotice">
        UPDATE sys_notice
        <set>
            <if test="tenantId != null">
                tenant_id = #{tenantId},
            </if>
            <if test="title != null and title != ''">
                title = #{title},
            </if>
            <if test="content != null and content != ''">
                content = #{content},
            </if>
            <if test="type != null">
                type = #{type},
            </if>
            <if test="level != null">
                level = #{level},
            </if>
            <if test="status != null">
                status = #{status},
            </if>
            <if test="publishTime != null">
                publish_time = #{publishTime},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime},
            </if>
            <if test="updateBy != null">
                update_by = #{updateBy},
            </if>
            <if test="isTop != null">
                is_top = #{isTop},
            </if>
            <if test="readStatus != null">
                read_status = #{readStatus}
            </if>
        </set>
        WHERE id = #{id}
    </update>

    <!-- 根据ID删除 -->
    <delete id="deleteById">
        DELETE FROM sys_notice WHERE id = #{id}
    </delete>

    <!-- 批量删除 - 支持批量删除功能 -->
    <delete id="deleteByIds">
        DELETE FROM sys_notice WHERE id IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <!-- 批量更新状态 -->
    <update id="updateStatusByIds">
        UPDATE sys_notice
        SET status = #{status}
        WHERE id IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>
</mapper>
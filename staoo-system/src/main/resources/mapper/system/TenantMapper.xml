<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.staoo.system.mapper.TenantMapper">
    <!-- 结果映射 -->
    <resultMap id="BaseResultMap" type="com.staoo.system.domain.Tenant">
        <id column="id" property="id" />
        <result column="tenant_name" property="tenantName" />
        <result column="status" property="status" />
        <result column="domain" property="domain" />
        <result column="contact_name" property="contactName" />
        <result column="contact_phone" property="contactPhone" />
        <result column="contact_email" property="contactEmail" />
        <result column="expire_time" property="expireTime" />
        <result column="create_by" property="createBy" />
        <result column="create_time" property="createTime" />
        <result column="update_by" property="updateBy" />
        <result column="update_time" property="updateTime" />
        <result column="remark" property="remark" />
    </resultMap>

    <!-- 基础SQL片段 -->
    <sql id="Base_Column_List">
        id, tenant_name, status, domain, contact_name, contact_phone, contact_email, expire_time,
        create_by, create_time, update_by, update_time, remark
    </sql>

    <!-- 查询条件SQL片段 -->
    <sql id="Query_Condition">
        <where>
            <if test="id != null">
                AND id = #{id}
            </if>
            <if test="tenantName != null and tenantName != ''">
                AND tenant_name LIKE CONCAT('%', #{tenantName}, '%')
            </if>
            <if test="status != null">
                AND status = #{status}
            </if>
            <if test="domain != null and domain != ''">
                AND domain LIKE CONCAT('%', #{domain}, '%')
            </if>
            <if test="contactName != null and contactName != ''">
                AND contact_name LIKE CONCAT('%', #{contactName}, '%')
            </if>
            <if test="contactPhone != null and contactPhone != ''">
                AND contact_phone LIKE CONCAT('%', #{contactPhone}, '%')
            </if>
            <if test="contactEmail != null and contactEmail != ''">
                AND contact_email LIKE CONCAT('%', #{contactEmail}, '%')
            </if>
            <if test="expireTime != null">
                AND expire_time = #{expireTime}
            </if>
            <if test="createBy != null">
                AND create_by = #{createBy}
            </if>
            <if test="updateBy != null">
                AND update_by = #{updateBy}
            </if>
        </where>
    </sql>

    <!-- 根据ID查询 -->
    <select id="getById" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List" />
        FROM sys_tenant
        WHERE id = #{id}
    </select>

    <!-- 根据租户名称查询 -->
    <select id="getByTenantName" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List" />
        FROM sys_tenant
        WHERE tenant_name = #{tenantName}
    </select>

    <!-- 查询租户列表 -->
    <select id="getList" parameterType="com.staoo.system.domain.Tenant" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List" />
        FROM sys_tenant
        <include refid="Query_Condition" />
        ORDER BY create_time DESC
    </select>

    <!-- 分页查询租户 -->
    <select id="getPage" parameterType="com.staoo.common.domain.PageQuery" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List" />
        FROM sys_tenant
        <where>
            <if test="params.tenantName != null and params.tenantName != ''">
                AND tenant_name LIKE CONCAT('%', #{params.tenantName}, '%')
            </if>
            <if test="params.status != null">
                AND status = #{params.status}
            </if>
            <if test="params.domain != null and params.domain != ''">
                AND domain LIKE CONCAT('%', #{params.domain}, '%')
            </if>
            <if test="params.keyword != null and params.keyword != ''">
                AND (
                    tenant_name LIKE CONCAT('%', #{params.keyword}, '%')
                    OR contact_name LIKE CONCAT('%', #{params.keyword}, '%')
                    OR contact_phone LIKE CONCAT('%', #{params.keyword}, '%')
                    OR contact_email LIKE CONCAT('%', #{params.keyword}, '%')
                )
            </if>
        </where>
        ORDER BY create_time DESC
    </select>

    <!-- 新增租户 -->
    <insert id="insert" parameterType="com.staoo.system.domain.Tenant">
        INSERT INTO sys_tenant (
            tenant_name, status, domain, contact_name, contact_phone, contact_email, expire_time,
            create_by, create_time, update_by, update_time, remark
        ) VALUES (
            #{tenantName}, #{status}, #{domain}, #{contactName}, #{contactPhone}, #{contactEmail}, #{expireTime},
            #{createBy}, #{createTime}, #{updateBy}, #{updateTime}, #{remark}
        )
    </insert>

    <!-- 修改租户 -->
    <update id="update" parameterType="com.staoo.system.domain.Tenant">
        UPDATE sys_tenant
        <set>
            <if test="tenantName != null and tenantName != ''">
                tenant_name = #{tenantName},
            </if>
            <if test="status != null">
                status = #{status},
            </if>
            <if test="domain != null and domain != ''">
                domain = #{domain},
            </if>
            <if test="contactName != null and contactName != ''">
                contact_name = #{contactName},
            </if>
            <if test="contactPhone != null and contactPhone != ''">
                contact_phone = #{contactPhone},
            </if>
            <if test="contactEmail != null and contactEmail != ''">
                contact_email = #{contactEmail},
            </if>
            <if test="expireTime != null">
                expire_time = #{expireTime},
            </if>
            <if test="updateBy != null">
                update_by = #{updateBy},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime},
            </if>
            <if test="remark != null and remark != ''">
                remark = #{remark},
            </if>
        </set>
        WHERE id = #{id}
    </update>

    <!-- 删除租户 -->
    <delete id="delete">
        DELETE FROM sys_tenant WHERE id = #{id}
    </delete>

    <!-- 批量删除租户 -->
    <delete id="deleteBatch">
        DELETE FROM sys_tenant WHERE id IN
        <foreach collection="array" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <!-- 查询租户总数 -->
    <select id="count" parameterType="com.staoo.system.domain.Tenant" resultType="int">
        SELECT COUNT(1)
        FROM sys_tenant
        <include refid="Query_Condition" />
    </select>
</mapper>
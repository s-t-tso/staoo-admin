<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.staoo.flow.mapper.FormTemplateMapper">
    <!-- 结果映射 -->
    <resultMap id="FormTemplateResultMap" type="com.staoo.flow.domain.FormTemplate">
        <id property="id" column="id"/>
        <result property="formKey" column="form_key"/>
        <result property="formName" column="form_name"/>
        <result property="description" column="description"/>
        <result property="formConfig" column="form_config"/>
        <result property="status" column="status"/>
        <result property="version" column="version"/>
        <result property="tenantId" column="tenant_id"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="createBy" column="create_by"/>
    </resultMap>

    <!-- 基础SQL片段 -->
    <sql id="Base_Column_List">
        id, form_key, form_name, description, form_config, status, version, tenant_id, create_time, update_time, create_by
    </sql>

    <!-- 查询条件SQL片段 -->
    <sql id="Query_Condition">
        <where>
            <if test="id != null">
                AND id = #{id}
            </if>
            <if test="formKey != null and formKey != ''">
                AND form_key = #{formKey}
            </if>
            <if test="formName != null and formName != ''">
                AND form_name like concat('%', #{formName}, '%')
            </if>
            <if test="status != null and status != ''">
                AND status = #{status}
            </if>
            <if test="version != null">
                AND version = #{version}
            </if>
            <if test="tenantId != null">
                AND tenant_id = #{tenantId}
            </if>
            <if test="createBy != null">
                AND create_by = #{createBy}
            </if>
        </where>
    </sql>

    <!-- 根据ID查询 -->
    <select id="getById" resultMap="FormTemplateResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM form_template
        WHERE id = #{id}
    </select>

    <!-- 根据表单标识查询 -->
    <select id="getByFormKey" resultMap="FormTemplateResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM form_template
        WHERE form_key = #{formKey}
        <if test="tenantId != null">
            AND tenant_id = #{tenantId}
        </if>
    </select>

    <!-- 查询表单模板列表 -->
    <select id="getList" resultMap="FormTemplateResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM form_template
        <include refid="Query_Condition"/>
        ORDER BY create_time DESC
    </select>

    <!-- 新增表单模板 -->
    <insert id="insert" parameterType="com.staoo.flow.domain.FormTemplate" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO form_template (
        form_key,
        form_name,
        description,
        form_config,
        status,
        version,
        tenant_id,
        create_time,
        update_time,
        create_by
        )
        VALUES (
        #{formKey},
        #{formName},
        #{description},
        #{formConfig},
        #{status},
        #{version},
        #{tenantId},
        #{createTime},
        #{updateTime},
        #{createBy}
        )
    </insert>

    <!-- 更新表单模板 -->
    <update id="update" parameterType="com.staoo.flow.domain.FormTemplate">
        UPDATE form_template
        <set>
            <if test="formKey != null and formKey != ''">
                form_key = #{formKey},
            </if>
            <if test="formName != null and formName != ''">
                form_name = #{formName},
            </if>
            <if test="description != null and description != ''">
                description = #{description},
            </if>
            <if test="formConfig != null and formConfig != ''">
                form_config = #{formConfig},
            </if>
            <if test="status != null and status != ''">
                status = #{status},
            </if>
            <if test="version != null">
                version = #{version},
            </if>
            <if test="tenantId != null">
                tenant_id = #{tenantId},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime},
            </if>
            <if test="createBy != null">
                create_by = #{createBy},
            </if>
        </set>
        WHERE id = #{id}
    </update>

    <!-- 删除表单模板 -->
    <delete id="deleteById">
        DELETE FROM form_template
        WHERE id = #{id}
    </delete>

    <!-- 批量删除表单模板 -->
    <delete id="deleteByIds">
        DELETE FROM form_template
        WHERE id IN
        <foreach item="id" collection="ids" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <!-- 查询表单模板总数 -->
    <select id="getCount" resultType="int">
        SELECT COUNT(1)
        FROM form_template
        <include refid="Query_Condition"/>
    </select>

    <!-- 根据租户ID查询所有表单模板 -->
    <select id="getListByTenantId" resultMap="FormTemplateResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM form_template
        WHERE tenant_id = #{tenantId}
        ORDER BY create_time DESC
    </select>

    <!-- 更新表单模板状态 -->
    <update id="updateStatus">
        UPDATE form_template
        SET status = #{status}
        WHERE id = #{id}
    </update>
</mapper>
# 项目规则文档

## 项目概述
本项目采用Java 21开发，基于Spring Boot 3.3.5、Spring Cloud 2023.0.5和Spring Cloud Alibaba 2023.0.3.2构建的微服务架构系统。

## 技术栈
- **基础框架**：Spring Boot 3.3.5、Spring Cloud 2023.0.5、Spring Cloud Alibaba 2023.0.3.2
- **注册中心/配置中心**：Nacos
- **持久层**：MyBatis
- **数据库**：MySQL 8.0
- **日志框架**：Logback
- **消息队列**：AMQP
- **工作流引擎**：Flowable 7.1.0
- **对象映射**：MapStruct 1.5.5.Final
- **HTTP客户端**：OkHttp 4.9.0
- **API文档**：SpringDoc
- **前端技术**：Vue3 + TypeScript + Vite + Vue Flow + Epic Designer

## 项目结构
### 多模块设计
- 采用Maven多模块结构
- 父模块统一管理版本依赖
- 子模块直接导入所需依赖，无需声明版本
- 模块命名格式：`作者名-功能名`
- staoo-ui为前端项目，规则遵循前端规则

### 核心模块
- **common**：公共组件、工具类、常量定义
- **framework**：权限拦截、通用框架配置
- **system**：系统管理模块（菜单、角色、部门、用户管理）
- **api**：对外暴露接口和Web应用配置

## 依赖管理规则
- 所有依赖版本在父模块的pom.xml中统一管理
- 子模块通过`<dependency>`标签导入，无需指定版本号
- 定期检查并更新依赖版本，确保安全性和稳定性
- 不允许使用lombok注解，避免引入额外的依赖
- 不允许子模块中使用扩展版本的依赖，保持与父模块版本一致
- 不允许在子模块中引入新的依赖，保持与父模块依赖一致

## 命名规范
- 模块名：`作者名-功能名`（小写字母，中划线连接）
- 包名：小写字母，多级包用点分隔，如`com.example.system.controller`
- 类名：帕斯卡命名法，如`UserController`
- 方法名：驼峰命名法，如`getUserById`
- 变量名：驼峰命名法，如`userName`
- 常量名：全大写字母，下划线分隔，如`MAX_RETRY_COUNT`

## 设计模式应用
- **桥接模式**：分离抽象和实现，提高系统灵活性
- **组装模式**：组合多个简单对象形成复杂对象
- **责任链模式**：处理请求的链式结构，如权限校验、参数验证
- **工厂模式**：创建对象的接口，隐藏创建逻辑
- **策略模式**：定义算法族，封装起来让它们之间可以互相替换

## 数据库设计规范
- 数据库表名：小写字母，多个单词用下划线分隔，如`user_info`
- 数据库字段名：小写字母，多个单词用下划线分隔，如`user_name`
- 数据库主键：`id`，自增类型，推荐使用`bigint`
- 数据库索引：根据业务需求添加索引，提高查询效率
- 数据库外键：不允许使用外键，避免循环依赖
- 数据库存储：不允许使用存储过程和存储函数，避免业务逻辑与数据库耦合
- 数据库字段：避免使用大字段（如text、blob），避免性能问题，建议使用分表或分库处理
- 数据库字段：避免使用NULL值，建议使用默认值或空字符串
- 数据库字段：避免使用浮点数存储金额，建议使用整数存储金额，单位为分
- 数据库字段：避免使用varchar存储手机号，建议使用char存储手机号，长度为11个字符
- 数据库数据删除：需要使用软删除，避免物理删除数据

## 日志规范
- 日志框架：使用Logback
- 日志级别：根据业务场景选择合适的日志级别，如INFO、DEBUG、ERROR等
- 日志格式：建议使用JSON格式，方便日志分析和处理
- 日志输出：避免在业务代码中直接输出日志，建议使用日志框架提供的API进行日志输出
- 日志配置：日志配置文件建议放在classpath下，如`logback.xml`

## 异常处理规范
- 异常处理机制：统一异常拦截器，分别处理通用异常、自定义业务异常、数据库异常、验证异常等
- 自定义异常类：创建自定义业务异常类，继承RuntimeException，包含错误码、错误消息等信息
- 异常状态和返回码：使用枚举定义所有异常状态和返回码，错误码具有唯一性和可读性，错误消息清晰明了
- 异常处理：在Controller层捕获异常，根据异常类型返回对应的错误码和错误消息
- 异常日志：记录异常信息，包括异常类型、异常消息、异常位置等，方便问题定位和排查

## 接口规范
- 接口路径：/api/模块名/接口名
- 接口方法：GET、POST、PUT、DELETE
- 接口参数：请求参数、路径参数、查询参数、请求体参数
- 接口响应：成功响应、失败响应
- 接口文档：通过SpringDoc自动生成

## 缓存规范
- 缓存框架：使用Redis
- 缓存策略：根据业务场景选择合适的缓存策略，如缓存穿透、缓存雪崩、缓存击穿等
- 缓存key设计：缓存key应唯一，建议使用模块名+接口名+参数名+参数值等组成，如`user_info:123`
- 缓存过期时间：根据业务场景设置合适的过期时间，避免缓存数据过期后立即失效
- 缓存刷新策略：根据业务场景选择合适的刷新策略，如定时刷新、手动刷新、主动刷新等

## 安全规范
- 接口安全：所有接口必须进行认证和授权校验，建议使用JWT或OAuth2等认证机制
- 数据安全：敏感数据传输必须使用HTTPS，数据库连接密码必须加密存储
- 防止SQL注入：使用MyBatis等框架提供的参数绑定机制，避免手动拼接SQL
- 防止XSS攻击：对用户输入进行过滤和转义，避免恶意脚本注入
- 防止CSRF攻击：使用CSRF令牌机制，避免跨站请求伪造

## 消息队列使用
- 消息队列：使用AMQP协议的消息队列，如RabbitMQ
- 消息队列命名：消息队列命名应唯一，建议使用模块名+队列名等组成，如`user_info_queue`
- 消息队列参数：根据业务场景设置合适的参数，如消息持久化、消息确认机制等
- 消息队列监听：使用注解或配置文件定义消息队列监听，如`@RabbitListener`
- 使用规范：如果业务当时并不需要返回结果，可考虑是否采用消息队列的方式，避免阻塞业务流程
- 消息队列异常处理：定义消息队列异常处理机制，如重试机制、死信队列等
- 消息队列参数：根据业务场景设置合适的参数，如消息持久化、消息确认机制等
- 消息队列确认：需要对消息队列执行有日志存储，记录消息的发送时间、接收时间、处理状态、重试次数、请求参数等

## 文档规范
- 每个模块、类、方法都应有详细的JavaDoc
- 复杂业务逻辑需添加注释说明
- API接口文档通过SpringDoc自动生成

## 版本控制
- 使用Git进行版本管理
- 遵循语义化版本规范
- 提交信息应清晰描述变更内容

## 代码质量要求
- 遵循Java编码规范
- 代码应具有高内聚低耦合特性
- 注重性能优化和安全性考虑
- 编写单元测试和集成测试

## 开发流程
- 需求分析 -> 设计 -> 编码 -> 测试 -> 提交 -> 评审 -> 发布
- 分支管理：master（主分支）、develop（开发分支）、feature（特性分支）、hotfix（修复分支）

## 修改
- 添加的新功能需要在readme.md文件中修改对应的文档
- 如果有产品上面的修改，需要对应修改产品文档，并且需要做记录
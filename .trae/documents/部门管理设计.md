# 部门管理模块设计文档
## 1. 架构概述
部门管理模块采用前后端分离架构，前端负责部门的展示和交互，后端提供RESTful API接口处理部门数据的增删改查等操作，支持树状层级结构管理。

## 2. 技术栈
- 前端技术：Vue3 + TypeScript + Vite
- 后端技术：Spring Boot 3.3.5 + MyBatis
- 数据库：MySQL 8.0

## 3. 数据模型设计
### 3.1 部门实体（Department）
```java
public class Department {
    private Long id;                 // 部门ID
    private String deptName;         // 部门名称
    private String remark;           // 部门备注
    private String status;           // 部门状态（正常、停用）
    private Integer sort;            // 部门排序
    private String params;           // 部门参数
    private Long parentId;           // 父部门ID
    private Long managerId;          // 部门主管ID
    private String deptCode;         // 部门编号
    private String contactPhone;     // 部门联系电话
    private String contactEmail;     // 部门联系邮箱
    private String contactAddress;   // 部门联系地址
    private Long tenantId;           // 租户ID
    private Date createTime;         // 创建时间
    private Date updateTime;         // 更新时间
    // Getters and Setters
}
```

### 3.2 数据库表结构
```sql
CREATE TABLE `sys_department` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '部门ID',
  `dept_name` varchar(20) NOT NULL COMMENT '部门名称',
  `remark` varchar(20) DEFAULT NULL COMMENT '部门备注',
  `status` varchar(10) DEFAULT NULL COMMENT '部门状态（正常、停用）',
  `sort` int DEFAULT '0' COMMENT '部门排序',
  `params` varchar(20) DEFAULT NULL COMMENT '部门参数',
  `parent_id` bigint DEFAULT NULL COMMENT '父部门ID',
  `manager_id` bigint DEFAULT NULL COMMENT '部门主管ID',
  `dept_code` varchar(20) NOT NULL COMMENT '部门编号',
  `contact_phone` varchar(11) DEFAULT NULL COMMENT '部门联系电话',
  `contact_email` varchar(20) DEFAULT NULL COMMENT '部门联系邮箱',
  `contact_address` varchar(20) DEFAULT NULL COMMENT '部门联系地址',
  `tenant_id` bigint NOT NULL COMMENT '租户ID',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_dept_code_tenant_id` (`dept_code`,`tenant_id`),
  KEY `idx_tenant_id` (`tenant_id`),
  KEY `idx_parent_id` (`parent_id`),
  KEY `idx_manager_id` (`manager_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统部门表';
```

## 4. API设计
### 4.1 查询部门树
- **URL**: `/api/system/department/tree`
- **Method**: GET
- **Request Param**: 
  - tenantId: 租户ID
- **Response**: 部门树状结构数据

### 4.2 新增部门
- **URL**: `/api/system/department`
- **Method**: POST
- **Request Body**: 部门实体对象
- **Response**: 操作结果

### 4.3 修改部门
- **URL**: `/api/system/department/{id}`
- **Method**: PUT
- **Request Body**: 部门实体对象
- **Response**: 操作结果

### 4.4 删除部门
- **URL**: `/api/system/department/{id}`
- **Method**: DELETE
- **Response**: 操作结果

### 4.5 查询部门详情
- **URL**: `/api/system/department/{id}`
- **Method**: GET
- **Response**: 部门详情

### 4.6 查询部门用户列表
- **URL**: `/api/system/department/{id}/users`
- **Method**: GET
- **Request Param**: 
  - page: 页码
  - pageSize: 每页条数
- **Response**: 部门下的用户列表及分页信息

## 5. 业务逻辑设计
### 5.1 部门树构建
- 根据父部门ID递归构建部门树状结构
- 支持按排序字段排序部门节点

### 5.2 部门校验逻辑
- 部门名称唯一性校验
- 部门编号唯一性校验（同租户下）
- 部门参数校验（长度、格式等）
- 部门主管用户存在性校验

### 5.3 部门编号生成逻辑
- 当用户未填写部门编号时，系统自动生成唯一的部门编号
- 生成规则：前缀+日期+随机数

### 5.4 部门删除逻辑
- 支持级联删除子部门
- 删除前校验部门是否有用户关联，如果有关联则不允许删除

### 5.5 部门用户关联逻辑
- 查询部门下的用户列表
- 支持将用户分配到部门

## 6. 前端设计
- 使用树形组件展示部门树状结构
- 提供部门新增、修改、删除的表单界面
- 支持拖拽调整部门顺序和层级
- 设计部门用户列表展示界面

## 7. 安全性设计
- 所有接口都需要进行租户ID校验
- 所有接口都需要进行权限校验，只有管理员角色才能操作部门
- 敏感操作需要进行二次确认

## 8. 性能优化
- 部门数据缓存设计，减少数据库查询
- 分页查询大量部门用户数据
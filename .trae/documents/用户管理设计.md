# 用户管理模块设计文档
## 1. 架构概述
用户管理模块采用前后端分离架构，前端负责用户的展示和交互，后端提供RESTful API接口处理用户数据的增删改查、导入导出等操作，实现用户的权限控制和登录管理。

## 2. 技术栈
- 前端技术：Vue3 + TypeScript + Vite
- 后端技术：Spring Boot 3.3.5 + MyBatis
- 数据库：MySQL 8.0
- 安全框架：Spring Security
- 文件处理：Apache POI（Excel导入导出）
- 缓存：Redis

## 3. 数据模型设计
### 3.1 用户实体（User）
```java
public class User {
    private Long id;                 // 用户ID
    private String userName;         // 用户名称
    private String password;         // 用户密码
    private String mobile;           // 用户手机号
    private String email;            // 用户邮箱
    private String status;           // 用户状态（正常、停用、离职）
    private String workNo;           // 用户工号
    private String remark;           // 用户备注
    private String contactPhone;     // 用户联系电话
    private String contactEmail;     // 用户联系邮箱
    private String contactAddress;   // 用户联系地址
    private Long tenantId;           // 租户ID
    private Date createTime;         // 创建时间
    private Date updateTime;         // 更新时间
    // Getters and Setters
}
```

### 3.2 数据库表结构
```sql
CREATE TABLE `sys_user` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `user_name` varchar(20) NOT NULL COMMENT '用户名称',
  `password` varchar(100) NOT NULL COMMENT '用户密码',
  `mobile` varchar(11) DEFAULT NULL COMMENT '用户手机号',
  `email` varchar(20) DEFAULT NULL COMMENT '用户邮箱',
  `status` varchar(10) DEFAULT NULL COMMENT '用户状态（正常、停用、离职）',
  `work_no` varchar(20) DEFAULT NULL COMMENT '用户工号',
  `remark` varchar(20) DEFAULT NULL COMMENT '用户备注',
  `contact_phone` varchar(11) DEFAULT NULL COMMENT '用户联系电话',
  `contact_email` varchar(20) DEFAULT NULL COMMENT '用户联系邮箱',
  `contact_address` varchar(20) DEFAULT NULL COMMENT '用户联系地址',
  `tenant_id` bigint NOT NULL COMMENT '租户ID',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_work_no_tenant_id` (`work_no`,`tenant_id`),
  UNIQUE KEY `uk_mobile_tenant_id` (`mobile`,`tenant_id`),
  UNIQUE KEY `uk_email_tenant_id` (`email`,`tenant_id`),
  KEY `idx_tenant_id` (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统用户表';
```

## 4. API设计
### 4.1 查询用户列表
- **URL**: `/api/system/user/list`
- **Method**: GET
- **Request Param**: 
  - tenantId: 租户ID
  - page: 页码
  - pageSize: 每页条数
  - userName: 用户名称（可选）
  - workNo: 用户工号（可选）
  - mobile: 用户手机号（可选）
  - status: 用户状态（可选）
  - deptId: 部门ID（可选）
  - roleId: 角色ID（可选）
- **Response**: 用户列表及分页信息

### 4.2 新增用户
- **URL**: `/api/system/user`
- **Method**: POST
- **Request Body**: 用户实体对象
- **Response**: 操作结果

### 4.3 修改用户
- **URL**: `/api/system/user/{id}`
- **Method**: PUT
- **Request Body**: 用户实体对象
- **Response**: 操作结果

### 4.4 删除用户
- **URL**: `/api/system/user/{id}`
- **Method**: DELETE
- **Response**: 操作结果

### 4.5 查询用户详情
- **URL**: `/api/system/user/{id}`
- **Method**: GET
- **Response**: 用户详情

### 4.6 批量删除用户
- **URL**: `/api/system/user/batch-delete`
- **Method**: POST
- **Request Body**: 用户ID列表
- **Response**: 操作结果

### 4.7 批量启用用户
- **URL**: `/api/system/user/batch-enable`
- **Method**: POST
- **Request Body**: 用户ID列表
- **Response**: 操作结果

### 4.8 批量停用用户
- **URL**: `/api/system/user/batch-disable`
- **Method**: POST
- **Request Body**: 用户ID列表
- **Response**: 操作结果

### 4.9 导入用户
- **URL**: `/api/system/user/import`
- **Method**: POST
- **Request Body**: Excel文件
- **Response**: 导入结果

### 4.10 导出用户
- **URL**: `/api/system/user/export`
- **Method**: GET
- **Request Param**: 
  - tenantId: 租户ID
  - queryParams: 查询参数（可选）
- **Response**: Excel文件

### 4.11 初始化用户密码
- **URL**: `/api/system/user/{id}/init-password`
- **Method**: POST
- **Response**: 操作结果

### 4.12 修改用户密码
- **URL**: `/api/system/user/change-password`
- **Method**: POST
- **Request Body**: 原密码、新密码
- **Response**: 操作结果

## 5. 业务逻辑设计
### 5.1 用户基本操作
- 用户的新增、修改、删除、查询
- 用户状态的启用/停用

### 5.2 用户工号生成逻辑
- 当用户未填写工号时，系统自动生成唯一的工号
- 生成规则：前缀+日期+序号

### 5.3 用户密码管理
- 密码加密存储（使用BCrypt或Argon2）
- 密码初始化和重置功能
- 密码复杂度校验

### 5.4 用户导入导出
- 使用Apache POI实现Excel文件的导入导出
- 导入数据校验和错误处理
- 导出数据格式化

### 5.5 用户权限关联
- 用户与角色的关联和解关联
- 用户与部门的关联和解关联

### 5.6 用户登录控制
- 多种登录方式支持（工号密码、手机号验证码、扫码登录）
- 登录失败次数限制和账号锁定
- 首次登录密码修改强制

## 6. 前端设计
- 使用表格展示用户列表，支持分页、排序、搜索
- 提供用户新增、修改、删除的表单界面
- 设计用户导入导出功能界面
- 实现用户角色和部门的选择器
- 提供用户密码初始化和修改功能

## 7. 安全性设计
- 所有接口都需要进行租户ID校验
- 所有接口都需要进行权限校验
- 密码加密存储和传输
- 敏感操作需要进行二次确认

## 8. 性能优化
- 用户数据缓存设计，减少数据库查询
- 分页查询大量用户数据
- 批量操作优化
- 导入导出性能优化
# 技术方案设计
## 架构概述
动态流程与表单审核功能采用分层架构设计，主要包括以下几个核心层次：
- **前端层**：提供可视化的流程设计器、表单设计器和流程管理界面
- **接入层**：提供RESTful API供前端调用
- **服务层**：实现流程管理、表单管理、任务处理等核心业务逻辑
- **引擎层**：集成Flowable工作流引擎，负责流程实例的执行和管理
- **持久层**：负责数据的存储和访问
- **通知层**：处理流程相关的通知和提醒

## 技术选型
- **基础框架**：Spring Boot 3.3.5
- **持久层**：MyBatis
- **数据库**：MySQL 8.0
- **工作流引擎**：Flowable 7.1.0
- **前端技术**：Vue3 + TypeScript + Vite + Vue Flow + Epic Designer
- **缓存**：Redis
- **消息队列**：RabbitMQ（用于异步通知和流程事件处理）
- **表单引擎**：自定义表单引擎 + JSON Schema
- **通知服务**：站内信、邮件、短信集成
- **API文档**：SpringDoc

## 核心模块设计
### 1. 流程实体设计
```java
package com.staoo.common.domain;

import java.time.LocalDateTime;
import java.util.Map;

/**
 * 流程定义实体类
 */
public class FlowDefinition {
    private String id;
    private String tenantId;
    private String name;
    private String key;
    private Integer version;
    private String category;
    private String description;
    private byte[] resourceBytes;
    private byte[] diagramBytes;
    private String deploymentId;
    private Boolean suspended;
    private LocalDateTime createTime;
    private LocalDateTime lastUpdateTime;
    private String formId;
    private String startFormKey;
    
    // getters and setters
}

/**
 * 流程实例实体类
 */
public class FlowInstance {
    private String id;
    private String tenantId;
    private String definitionId;
    private String definitionKey;
    private Integer definitionVersion;
    private String businessKey;
    private String name;
    private String startUserId;
    private LocalDateTime startTime;
    private LocalDateTime endTime;
    private String status;
    private Map<String, Object> variables;
    private String formDataId;
    
    // getters and setters
}

/**
 * 任务实体类
 */
public class FlowTask {
    private String id;
    private String instanceId;
    private String definitionId;
    private String taskDefinitionKey;
    private String name;
    private String assignee;
    private String owner;
    private LocalDateTime createTime;
    private LocalDateTime dueDate;
    private Integer priority;
    private String status;
    private Map<String, Object> variables;
    
    // getters and setters
}

/**
 * 历史任务实体类
 */
public class HistoricTask {
    private String id;
    private String instanceId;
    private String definitionId;
    private String taskDefinitionKey;
    private String name;
    private String assignee;
    private LocalDateTime createTime;
    private LocalDateTime claimTime;
    private LocalDateTime endTime;
    private Long durationInMillis;
    private String deleteReason;
    private String outcome;
    private String comment;
    
    // getters and setters
}

/**
 * 流程评论实体类
 */
public class FlowComment {
    private String id;
    private String taskId;
    private String instanceId;
    private String userId;
    private String userName;
    private String type;
    private String message;
    private LocalDateTime time;
    private String fullMessage;
    
    // getters and setters
}
```

### 2. 表单实体设计
```java
/**
 * 表单定义实体类
 */
public class FormDefinition {
    private String id;
    private String tenantId;
    private String name;
    private String key;
    private Integer version;
    private String description;
    private String schema;
    private String config;
    private LocalDateTime createTime;
    private LocalDateTime updateTime;
    private String creatorId;
    private String creatorName;
    
    // getters and setters
}

/**
 * 表单数据实体类
 */
public class FormData {
    private String id;
    private String tenantId;
    private String formId;
    private String instanceId;
    private String businessKey;
    private String data;
    private String creatorId;
    private String creatorName;
    private LocalDateTime createTime;
    private LocalDateTime updateTime;
    private String status;
    
    // getters and setters
}

/**
 * 流程模板实体类
 */
public class FlowTemplate {
    private String id;
    private String tenantId;
    private String name;
    private String description;
    private String definitionJson;
    private String formJson;
    private Boolean isPublic;
    private LocalDateTime createTime;
    private LocalDateTime updateTime;
    
    // getters and setters
}
```

### 3. 流程服务接口
```java
package com.staoo.system.service;

/**
 * 流程定义服务接口
 */
public interface FlowDefinitionService {
    /**
     * 部署流程定义
     * @param deploymentRequest 部署请求
     * @return 部署结果
     */
    DeploymentResult deploy(DeploymentRequest deploymentRequest);
    
    /**
     * 获取流程定义列表
     * @param query 查询参数
     * @return 分页结果
     */
    PageResult<FlowDefinition> getDefinitions(FlowDefinitionQuery query);
    
    /**
     * 获取流程定义详情
     * @param definitionId 流程定义ID
     * @return 流程定义详情
     */
    FlowDefinition getDefinition(String definitionId);
    
    /**
     * 激活/挂起流程定义
     * @param definitionId 流程定义ID
     * @param suspended 是否挂起
     */
    void updateDefinitionSuspended(String definitionId, boolean suspended);
    
    /**
     * 删除流程定义
     * @param definitionId 流程定义ID
     * @param cascade 是否级联删除
     */
    void deleteDefinition(String definitionId, boolean cascade);
    
    /**
     * 获取流程定义的XML内容
     * @param definitionId 流程定义ID
     * @return XML内容
     */
    String getDefinitionXml(String definitionId);
    
    /**
     * 获取流程定义的流程图
     * @param definitionId 流程定义ID
     * @return 流程图字节数组
     */
    byte[] getDefinitionDiagram(String definitionId);
}

/**
 * 流程实例服务接口
 */
public interface FlowInstanceService {
    /**
     * 启动流程实例
     * @param startRequest 启动请求
     * @return 流程实例
     */
    FlowInstance startInstance(StartInstanceRequest startRequest);
    
    /**
     * 获取流程实例列表
     * @param query 查询参数
     * @return 分页结果
     */
    PageResult<FlowInstance> getInstances(FlowInstanceQuery query);
    
    /**
     * 获取流程实例详情
     * @param instanceId 流程实例ID
     * @return 流程实例详情
     */
    FlowInstance getInstance(String instanceId);
    
    /**
     * 暂停/激活流程实例
     * @param instanceId 流程实例ID
     * @param suspended 是否暂停
     */
    void updateInstanceSuspended(String instanceId, boolean suspended);
    
    /**
     * 结束流程实例
     * @param instanceId 流程实例ID
     * @param reason 结束原因
     */
    void terminateInstance(String instanceId, String reason);
    
    /**
     * 获取流程实例的当前活动节点
     * @param instanceId 流程实例ID
     * @return 活动节点列表
     */
    List<Activity> getActiveActivities(String instanceId);
    
    /**
     * 获取流程实例的历史任务
     * @param instanceId 流程实例ID
     * @return 历史任务列表
     */
    List<HistoricTask> getInstanceHistoricTasks(String instanceId);
}

/**
 * 任务服务接口
 */
public interface FlowTaskService {
    /**
     * 获取待办任务列表
     * @param query 查询参数
     * @return 分页结果
     */
    PageResult<FlowTask> getTodoTasks(TaskQuery query);
    
    /**
     * 获取已办任务列表
     * @param query 查询参数
     * @return 分页结果
     */
    PageResult<HistoricTask> getDoneTasks(HistoricTaskQuery query);
    
    /**
     * 获取任务详情
     * @param taskId 任务ID
     * @return 任务详情
     */
    FlowTask getTask(String taskId);
    
    /**
     * 认领任务
     * @param taskId 任务ID
     * @param userId 用户ID
     */
    void claimTask(String taskId, String userId);
    
    /**
     * 取消认领任务
     * @param taskId 任务ID
     */
    void unclaimTask(String taskId);
    
    /**
     * 完成任务
     * @param completeRequest 完成请求
     */
    void completeTask(CompleteTaskRequest completeRequest);
    
    /**
     * 驳回任务
     * @param rejectRequest 驳回请求
     */
    void rejectTask(RejectTaskRequest rejectRequest);
    
    /**
     * 转办任务
     * @param assignRequest 转办请求
     */
    void assignTask(AssignTaskRequest assignRequest);
    
    /**
     * 添加任务评论
     * @param commentRequest 评论请求
     * @return 评论ID
     */
    String addTaskComment(CommentRequest commentRequest);
    
    /**
     * 获取任务评论
     * @param taskId 任务ID
     * @return 评论列表
     */
    List<FlowComment> getTaskComments(String taskId);
}

/**
 * 表单服务接口
 */
public interface FormService {
    /**
     * 创建表单定义
     * @param formDefinition 表单定义
     * @return 表单定义
     */
    FormDefinition createForm(FormDefinition formDefinition);
    
    /**
     * 更新表单定义
     * @param formDefinition 表单定义
     * @return 表单定义
     */
    FormDefinition updateForm(FormDefinition formDefinition);
    
    /**
     * 获取表单定义列表
     * @param query 查询参数
     * @return 分页结果
     */
    PageResult<FormDefinition> getForms(FormQuery query);
    
    /**
     * 获取表单定义详情
     * @param formId 表单ID
     * @return 表单定义详情
     */
    FormDefinition getForm(String formId);
    
    /**
     * 删除表单定义
     * @param formId 表单ID
     */
    void deleteForm(String formId);
    
    /**
     * 保存表单数据
     * @param formData 表单数据
     * @return 表单数据
     */
    FormData saveFormData(FormData formData);
    
    /**
     * 获取表单数据
     * @param dataId 数据ID
     * @return 表单数据
     */
    FormData getFormData(String dataId);
    
    /**
     * 查询表单数据列表
     * @param query 查询参数
     * @return 分页结果
     */
    PageResult<FormData> getFormDatas(FormDataQuery query);
}
```

## 数据库设计
### 1. 流程定义表（flow_definition）
```sql
CREATE TABLE `flow_definition` (
  `id` varchar(64) NOT NULL COMMENT '流程定义ID',
  `tenant_id` varchar(32) DEFAULT NULL COMMENT '租户ID',
  `name` varchar(255) DEFAULT NULL COMMENT '流程名称',
  `key` varchar(255) DEFAULT NULL COMMENT '流程键',
  `version` int DEFAULT NULL COMMENT '版本号',
  `category` varchar(255) DEFAULT NULL COMMENT '分类',
  `description` text COMMENT '描述',
  `deployment_id` varchar(64) DEFAULT NULL COMMENT '部署ID',
  `suspended` tinyint(1) DEFAULT NULL COMMENT '是否挂起',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `last_update_time` datetime DEFAULT NULL COMMENT '最后更新时间',
  `form_id` varchar(64) DEFAULT NULL COMMENT '关联表单ID',
  `start_form_key` varchar(255) DEFAULT NULL COMMENT '启动表单键',
  PRIMARY KEY (`id`),
  KEY `idx_tenant_id` (`tenant_id`),
  KEY `idx_key` (`key`),
  KEY `idx_deployment_id` (`deployment_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='流程定义表';
```

### 2. 流程实例表（flow_instance）
```sql
CREATE TABLE `flow_instance` (
  `id` varchar(64) NOT NULL COMMENT '流程实例ID',
  `tenant_id` varchar(32) DEFAULT NULL COMMENT '租户ID',
  `definition_id` varchar(64) DEFAULT NULL COMMENT '流程定义ID',
  `definition_key` varchar(255) DEFAULT NULL COMMENT '流程定义键',
  `definition_version` int DEFAULT NULL COMMENT '流程定义版本',
  `business_key` varchar(255) DEFAULT NULL COMMENT '业务键',
  `name` varchar(255) DEFAULT NULL COMMENT '实例名称',
  `start_user_id` varchar(64) DEFAULT NULL COMMENT '启动用户ID',
  `start_time` datetime DEFAULT NULL COMMENT '启动时间',
  `end_time` datetime DEFAULT NULL COMMENT '结束时间',
  `status` varchar(20) DEFAULT NULL COMMENT '状态',
  `form_data_id` varchar(64) DEFAULT NULL COMMENT '表单数据ID',
  PRIMARY KEY (`id`),
  KEY `idx_tenant_id` (`tenant_id`),
  KEY `idx_definition_id` (`definition_id`),
  KEY `idx_business_key` (`business_key`),
  KEY `idx_start_user_id` (`start_user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='流程实例表';
```

### 3. 任务表（flow_task）
```sql
CREATE TABLE `flow_task` (
  `id` varchar(64) NOT NULL COMMENT '任务ID',
  `instance_id` varchar(64) DEFAULT NULL COMMENT '流程实例ID',
  `definition_id` varchar(64) DEFAULT NULL COMMENT '流程定义ID',
  `task_definition_key` varchar(255) DEFAULT NULL COMMENT '任务定义键',
  `name` varchar(255) DEFAULT NULL COMMENT '任务名称',
  `assignee` varchar(64) DEFAULT NULL COMMENT '处理人',
  `owner` varchar(64) DEFAULT NULL COMMENT '拥有者',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `due_date` datetime DEFAULT NULL COMMENT '到期时间',
  `priority` int DEFAULT NULL COMMENT '优先级',
  `status` varchar(20) DEFAULT NULL COMMENT '状态',
  PRIMARY KEY (`id`),
  KEY `idx_tenant_id` (`tenant_id`),
  KEY `idx_instance_id` (`instance_id`),
  KEY `idx_assignee` (`assignee`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='任务表';
```

### 4. 历史任务表（flow_historic_task）
```sql
CREATE TABLE `flow_historic_task` (
  `id` varchar(64) NOT NULL COMMENT '历史任务ID',
  `instance_id` varchar(64) DEFAULT NULL COMMENT '流程实例ID',
  `definition_id` varchar(64) DEFAULT NULL COMMENT '流程定义ID',
  `task_definition_key` varchar(255) DEFAULT NULL COMMENT '任务定义键',
  `name` varchar(255) DEFAULT NULL COMMENT '任务名称',
  `assignee` varchar(64) DEFAULT NULL COMMENT '处理人',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `claim_time` datetime DEFAULT NULL COMMENT '认领时间',
  `end_time` datetime DEFAULT NULL COMMENT '结束时间',
  `duration_in_millis` bigint DEFAULT NULL COMMENT '持续时间(毫秒)',
  `delete_reason` varchar(255) DEFAULT NULL COMMENT '删除原因',
  `outcome` varchar(255) DEFAULT NULL COMMENT '处理结果',
  `comment` text COMMENT '处理意见',
  PRIMARY KEY (`id`),
  KEY `idx_instance_id` (`instance_id`),
  KEY `idx_assignee` (`assignee`),
  KEY `idx_end_time` (`end_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='历史任务表';
```

### 5. 表单定义表（form_definition）
```sql
CREATE TABLE `form_definition` (
  `id` varchar(64) NOT NULL COMMENT '表单定义ID',
  `tenant_id` varchar(32) DEFAULT NULL COMMENT '租户ID',
  `name` varchar(255) DEFAULT NULL COMMENT '表单名称',
  `key` varchar(255) DEFAULT NULL COMMENT '表单键',
  `version` int DEFAULT NULL COMMENT '版本号',
  `description` text COMMENT '描述',
  `schema` longtext COMMENT '表单JSON Schema',
  `config` longtext COMMENT '表单配置',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `update_time` datetime DEFAULT NULL COMMENT '更新时间',
  `creator_id` varchar(64) DEFAULT NULL COMMENT '创建者ID',
  `creator_name` varchar(50) DEFAULT NULL COMMENT '创建者名称',
  PRIMARY KEY (`id`),
  KEY `idx_tenant_id` (`tenant_id`),
  KEY `idx_key` (`key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='表单定义表';
```

### 6. 表单数据表（form_data）
```sql
CREATE TABLE `form_data` (
  `id` varchar(64) NOT NULL COMMENT '表单数据ID',
  `tenant_id` varchar(32) DEFAULT NULL COMMENT '租户ID',
  `form_id` varchar(64) DEFAULT NULL COMMENT '表单定义ID',
  `instance_id` varchar(64) DEFAULT NULL COMMENT '流程实例ID',
  `business_key` varchar(255) DEFAULT NULL COMMENT '业务键',
  `data` longtext COMMENT '表单数据(JSON格式)',
  `creator_id` varchar(64) DEFAULT NULL COMMENT '创建者ID',
  `creator_name` varchar(50) DEFAULT NULL COMMENT '创建者名称',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `update_time` datetime DEFAULT NULL COMMENT '更新时间',
  `status` varchar(20) DEFAULT NULL COMMENT '状态',
  PRIMARY KEY (`id`),
  KEY `idx_tenant_id` (`tenant_id`),
  KEY `idx_form_id` (`form_id`),
  KEY `idx_instance_id` (`instance_id`),
  KEY `idx_business_key` (`business_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='表单数据表';
```

### 7. 流程模板表（flow_template）
```sql
CREATE TABLE `flow_template` (
  `id` varchar(64) NOT NULL COMMENT '模板ID',
  `tenant_id` varchar(32) DEFAULT NULL COMMENT '租户ID',
  `name` varchar(255) DEFAULT NULL COMMENT '模板名称',
  `description` text COMMENT '描述',
  `definition_json` longtext COMMENT '流程定义JSON',
  `form_json` longtext COMMENT '表单定义JSON',
  `is_public` tinyint(1) DEFAULT NULL COMMENT '是否公开',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `update_time` datetime DEFAULT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_tenant_id` (`tenant_id`),
  KEY `idx_is_public` (`is_public`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='流程模板表';
```

## 接口设计
### 1. 流程定义接口
```java
package com.staoo.system.controller;

@RestController
@RequestMapping("/api/system/flow/definition")
public class FlowDefinitionController {
    private final FlowDefinitionService flowDefinitionService;
    
    @PostMapping("/deploy")
    public R<DeploymentResult> deploy(@RequestBody DeploymentRequest request) {
        return R.ok(flowDefinitionService.deploy(request));
    }
    
    @GetMapping
    public R<PageResult<FlowDefinition>> getDefinitions(FlowDefinitionQuery query) {
        return R.ok(flowDefinitionService.getDefinitions(query));
    }
    
    @GetMapping("/{definitionId}")
    public R<FlowDefinition> getDefinition(@PathVariable String definitionId) {
        return R.ok(flowDefinitionService.getDefinition(definitionId));
    }
    
    @PutMapping("/{definitionId}/suspended")
    public R<Void> updateDefinitionSuspended(@PathVariable String definitionId, 
                                           @RequestParam boolean suspended) {
        flowDefinitionService.updateDefinitionSuspended(definitionId, suspended);
        return R.ok();
    }
    
    @DeleteMapping("/{definitionId}")
    public R<Void> deleteDefinition(@PathVariable String definitionId, 
                                  @RequestParam(defaultValue = "false") boolean cascade) {
        flowDefinitionService.deleteDefinition(definitionId, cascade);
        return R.ok();
    }
    
    @GetMapping("/{definitionId}/xml")
    public R<String> getDefinitionXml(@PathVariable String definitionId) {
        return R.ok(flowDefinitionService.getDefinitionXml(definitionId));
    }
    
    @GetMapping("/{definitionId}/diagram")
    public ResponseEntity<byte[]> getDefinitionDiagram(@PathVariable String definitionId) {
        byte[] diagram = flowDefinitionService.getDefinitionDiagram(definitionId);
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.IMAGE_PNG);
        return new ResponseEntity<>(diagram, headers, HttpStatus.OK);
    }
}
```

### 2. 流程实例接口
```java
@RestController
@RequestMapping("/api/system/flow/instance")
public class FlowInstanceController {
    private final FlowInstanceService flowInstanceService;
    
    @PostMapping
    public R<FlowInstance> startInstance(@RequestBody StartInstanceRequest request) {
        return R.ok(flowInstanceService.startInstance(request));
    }
    
    @GetMapping
    public R<PageResult<FlowInstance>> getInstances(FlowInstanceQuery query) {
        return R.ok(flowInstanceService.getInstances(query));
    }
    
    @GetMapping("/{instanceId}")
    public R<FlowInstance> getInstance(@PathVariable String instanceId) {
        return R.ok(flowInstanceService.getInstance(instanceId));
    }
    
    @PutMapping("/{instanceId}/suspended")
    public R<Void> updateInstanceSuspended(@PathVariable String instanceId, 
                                         @RequestParam boolean suspended) {
        flowInstanceService.updateInstanceSuspended(instanceId, suspended);
        return R.ok();
    }
    
    @DeleteMapping("/{instanceId}")
    public R<Void> terminateInstance(@PathVariable String instanceId, 
                                   @RequestParam(required = false) String reason) {
        flowInstanceService.terminateInstance(instanceId, reason);
        return R.ok();
    }
    
    @GetMapping("/{instanceId}/activities")
    public R<List<Activity>> getActiveActivities(@PathVariable String instanceId) {
        return R.ok(flowInstanceService.getActiveActivities(instanceId));
    }
    
    @GetMapping("/{instanceId}/historic-tasks")
    public R<List<HistoricTask>> getInstanceHistoricTasks(@PathVariable String instanceId) {
        return R.ok(flowInstanceService.getInstanceHistoricTasks(instanceId));
    }
}
```

### 3. 任务接口
```java
@RestController
@RequestMapping("/api/system/flow/task")
public class FlowTaskController {
    private final FlowTaskService flowTaskService;
    
    @GetMapping("/todo")
    public R<PageResult<FlowTask>> getTodoTasks(TaskQuery query) {
        return R.ok(flowTaskService.getTodoTasks(query));
    }
    
    @GetMapping("/done")
    public R<PageResult<HistoricTask>> getDoneTasks(HistoricTaskQuery query) {
        return R.ok(flowTaskService.getDoneTasks(query));
    }
    
    @GetMapping("/{taskId}")
    public R<FlowTask> getTask(@PathVariable String taskId) {
        return R.ok(flowTaskService.getTask(taskId));
    }
    
    @PutMapping("/{taskId}/claim")
    public R<Void> claimTask(@PathVariable String taskId, @RequestParam String userId) {
        flowTaskService.claimTask(taskId, userId);
        return R.ok();
    }
    
    @PutMapping("/{taskId}/unclaim")
    public R<Void> unclaimTask(@PathVariable String taskId) {
        flowTaskService.unclaimTask(taskId);
        return R.ok();
    }
    
    @PostMapping("/{taskId}/complete")
    public R<Void> completeTask(@PathVariable String taskId, 
                              @RequestBody CompleteTaskRequest request) {
        request.setTaskId(taskId);
        flowTaskService.completeTask(request);
        return R.ok();
    }
    
    @PostMapping("/{taskId}/reject")
    public R<Void> rejectTask(@PathVariable String taskId, 
                            @RequestBody RejectTaskRequest request) {
        request.setTaskId(taskId);
        flowTaskService.rejectTask(request);
        return R.ok();
    }
    
    @PutMapping("/{taskId}/assign")
    public R<Void> assignTask(@PathVariable String taskId, 
                            @RequestBody AssignTaskRequest request) {
        request.setTaskId(taskId);
        flowTaskService.assignTask(request);
        return R.ok();
    }
    
    @PostMapping("/{taskId}/comments")
    public R<String> addTaskComment(@PathVariable String taskId, 
                                 @RequestBody CommentRequest request) {
        request.setTaskId(taskId);
        return R.ok(flowTaskService.addTaskComment(request));
    }
    
    @GetMapping("/{taskId}/comments")
    public R<List<FlowComment>> getTaskComments(@PathVariable String taskId) {
        return R.ok(flowTaskService.getTaskComments(taskId));
    }
}
```

### 4. 表单接口
```java
@RestController
@RequestMapping("/api/system/form")
public class FormController {
    private final FormService formService;
    
    @PostMapping
    public R<FormDefinition> createForm(@RequestBody FormDefinition formDefinition) {
        return R.ok(formService.createForm(formDefinition));
    }
    
    @PutMapping("/{formId}")
    public R<FormDefinition> updateForm(@PathVariable String formId, 
                                     @RequestBody FormDefinition formDefinition) {
        formDefinition.setId(formId);
        return R.ok(formService.updateForm(formDefinition));
    }
    
    @GetMapping
    public R<PageResult<FormDefinition>> getForms(FormQuery query) {
        return R.ok(formService.getForms(query));
    }
    
    @GetMapping("/{formId}")
    public R<FormDefinition> getForm(@PathVariable String formId) {
        return R.ok(formService.getForm(formId));
    }
    
    @DeleteMapping("/{formId}")
    public R<Void> deleteForm(@PathVariable String formId) {
        formService.deleteForm(formId);
        return R.ok();
    }
    
    @PostMapping("/data")
    public R<FormData> saveFormData(@RequestBody FormData formData) {
        return R.ok(formService.saveFormData(formData));
    }
    
    @GetMapping("/data/{dataId}")
    public R<FormData> getFormData(@PathVariable String dataId) {
        return R.ok(formService.getFormData(dataId));
    }
    
    @GetMapping("/data")
    public R<PageResult<FormData>> getFormDatas(FormDataQuery query) {
        return R.ok(formService.getFormDatas(query));
    }
}
```

## 安全性考虑
1. **多租户隔离**：通过租户ID确保不同租户的流程数据相互隔离。
2. **权限控制**：严格的流程权限控制机制，确保只有授权用户才能创建、启动、查看和处理流程。
3. **数据安全**：敏感表单数据的加密存储和传输。
4. **流程审计**：完整记录流程的所有操作和状态变更，方便审计和追溯。
5. **防止SQL注入**：使用参数化查询，避免直接拼接SQL语句。
6. **防止XSS攻击**：对用户输入进行过滤和转义，避免恶意脚本注入。

## 性能优化
1. **流程缓存**：使用Redis缓存流程定义、流程实例和任务数据，提高访问速度。
2. **异步处理**：使用消息队列进行异步通知和流程事件处理，避免阻塞主线程。
3. **数据库优化**：为常用查询字段添加索引，优化查询性能。
4. **分页查询**：所有列表查询均支持分页，避免一次性加载大量数据。
5. **流程设计器性能**：优化前端流程设计器的渲染和拖拽性能。

## 测试策略
1. **单元测试**：测试各个模块的功能，包括流程定义、流程实例、任务处理等。
2. **集成测试**：测试各个模块之间的交互，确保整个流程管理系统正常工作。
3. **性能测试**：测试在高并发场景下流程管理系统的性能表现。
4. **安全测试**：测试流程管理系统的安全性，包括权限控制、数据隔离等。
5. **兼容性测试**：测试不同浏览器和操作系统下的流程设计器和表单设计器。
6. **流程场景测试**：设计各种复杂的流程场景进行测试，确保流程引擎能够正确处理各种情况。
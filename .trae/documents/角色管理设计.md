# 角色管理模块设计文档
## 1. 架构概述
角色管理模块采用前后端分离架构，前端负责角色的展示和交互，后端提供RESTful API接口处理角色数据的增删改查等操作，实现RBAC权限模型。

## 2. 技术栈
- 前端技术：Vue3 + TypeScript + Vite
- 后端技术：Spring Boot 3.3.5 + MyBatis
- 数据库：MySQL 8.0

## 3. 数据模型设计
### 3.1 角色实体（Role）
```java
public class Role {
    private Long id;                 // 角色ID
    private String roleName;         // 角色名称
    private String remark;           // 角色备注
    private String status;           // 角色状态（正常、停用）
    private String params;           // 角色参数
    private Integer sort;            // 角色排序
    private Long tenantId;           // 租户ID
    private Date createTime;         // 创建时间
    private Date updateTime;         // 更新时间
    // Getters and Setters
}
```

### 3.2 角色菜单关联实体（RoleMenu）
```java
public class RoleMenu {
    private Long id;                 // 关联ID
    private Long roleId;             // 角色ID
    private Long menuId;             // 菜单ID
    private String permission;       // 操作权限
    // Getters and Setters
}
```

### 3.3 角色用户关联实体（RoleUser）
```java
public class RoleUser {
    private Long id;                 // 关联ID
    private Long roleId;             // 角色ID
    private Long userId;             // 用户ID
    // Getters and Setters
}
```

### 3.4 数据库表结构
```sql
-- 角色表
CREATE TABLE `sys_role` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '角色ID',
  `role_name` varchar(20) NOT NULL COMMENT '角色名称',
  `remark` varchar(20) DEFAULT NULL COMMENT '角色备注',
  `status` varchar(10) DEFAULT NULL COMMENT '角色状态（正常、停用）',
  `params` varchar(20) DEFAULT NULL COMMENT '角色参数',
  `sort` int DEFAULT '0' COMMENT '角色排序',
  `tenant_id` bigint NOT NULL COMMENT '租户ID',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_tenant_id` (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统角色表';

-- 角色菜单关联表
CREATE TABLE `sys_role_menu` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '关联ID',
  `role_id` bigint NOT NULL COMMENT '角色ID',
  `menu_id` bigint NOT NULL COMMENT '菜单ID',
  `permission` varchar(50) DEFAULT NULL COMMENT '操作权限',
  PRIMARY KEY (`id`),
  KEY `idx_role_id` (`role_id`),
  KEY `idx_menu_id` (`menu_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色菜单关联表';

-- 角色用户关联表
CREATE TABLE `sys_role_user` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '关联ID',
  `role_id` bigint NOT NULL COMMENT '角色ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  PRIMARY KEY (`id`),
  KEY `idx_role_id` (`role_id`),
  KEY `idx_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色用户关联表';
```

## 4. API设计
### 4.1 查询角色列表
- **URL**: `/api/system/role/list`
- **Method**: GET
- **Request Param**: 
  - tenantId: 租户ID
  - page: 页码
  - pageSize: 每页条数
  - roleName: 角色名称（可选）
  - status: 角色状态（可选）
- **Response**: 角色列表及分页信息

### 4.2 新增角色
- **URL**: `/api/system/role`
- **Method**: POST
- **Request Body**: 角色实体对象
- **Response**: 操作结果

### 4.3 修改角色
- **URL**: `/api/system/role/{id}`
- **Method**: PUT
- **Request Body**: 角色实体对象
- **Response**: 操作结果

### 4.4 删除角色
- **URL**: `/api/system/role/{id}`
- **Method**: DELETE
- **Response**: 操作结果

### 4.5 查询角色详情
- **URL**: `/api/system/role/{id}`
- **Method**: GET
- **Response**: 角色详情

### 4.6 配置角色菜单权限
- **URL**: `/api/system/role/{id}/menu-permissions`
- **Method**: POST
- **Request Body**: 菜单权限列表
- **Response**: 操作结果

### 4.7 配置角色数据权限
- **URL**: `/api/system/role/{id}/data-permissions`
- **Method**: POST
- **Request Body**: 数据权限配置
- **Response**: 操作结果

### 4.8 关联角色用户
- **URL**: `/api/system/role/{id}/users`
- **Method**: POST
- **Request Body**: 用户ID列表
- **Response**: 操作结果

## 5. 业务逻辑设计
### 5.1 角色基本操作
- 角色的新增、修改、删除、查询
- 角色状态的启用/停用

### 5.2 角色权限配置
- 角色菜单权限的分配和管理
- 角色数据权限的分配和管理
- 基于RBAC模型的权限控制逻辑

### 5.3 角色用户关联
- 角色与用户的关联和解关联
- 批量为用户分配角色

### 5.4 权限校验逻辑
- 角色名称唯一性校验
- 角色删除前校验（是否被用户关联）
- 权限配置的合法性校验

## 6. 前端设计
- 使用表格展示角色列表，支持分页、排序、搜索
- 提供角色新增、修改、删除的表单界面
- 设计菜单权限配置界面，使用树形结构展示菜单
- 设计数据权限配置界面
- 设计角色用户关联界面

## 7. 安全性设计
- 所有接口都需要进行租户ID校验
- 所有接口都需要进行权限校验，只有管理员角色才能操作角色
- 敏感操作需要进行二次确认

## 8. 性能优化
- 角色数据缓存设计，减少数据库查询
- 权限数据缓存设计，提高权限校验效率
- 分页查询大量角色数据
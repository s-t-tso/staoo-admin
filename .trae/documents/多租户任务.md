# 多租户功能实施计划

## 数据库设计与修改
- [ ] 1. 创建租户表`sys_tenant`
  - 包含租户ID、租户名称、备注、状态等字段
  - 添加唯一索引和普通索引
  - _需求: 需求1-租户管理_
- [ ] 2. 修改现有业务表
  - 为所有业务表添加`tenant_id`字段
  - 为`tenant_id`字段添加索引
  - _需求: 需求2-数据隔离_

## 核心组件开发
- [ ] 3. 开发租户实体类
  - 创建`Tenant`实体类
  - 添加Getter和Setter方法
  - _需求: 需求1-租户管理_
- [ ] 4. 开发租户上下文管理类
  - 创建`TenantContext`类
  - 实现基于ThreadLocal的租户上下文管理
  - _需求: 需求2-数据隔离_
- [ ] 5. 开发租户拦截器
  - 创建`TenantInterceptor`类实现HandlerInterceptor接口
  - 从请求头中获取租户ID并设置到上下文
  - _需求: 需求3-多租户支持的接口设计_

## MyBatis多租户支持
- [ ] 6. 开发MyBatis多租户插件
  - 创建`TenantSqlInterceptor`类实现Interceptor接口
  - 拦截SQL查询和更新操作，添加租户条件
  - _需求: 需求2-数据隔离_
- [ ] 7. 配置MyBatis插件
  - 在MyBatis配置文件中注册多租户插件
  - 配置需要拦截的表和忽略的表
  - _需求: 需求2-数据隔离_

## 租户管理功能实现
- [ ] 8. 开发租户Mapper接口
  - 创建`TenantMapper`接口
  - 实现租户的增删改查操作
  - _需求: 需求1-租户管理_
- [ ] 9. 开发租户Service接口及实现
  - 创建`TenantService`接口和`TenantServiceImpl`实现类
  - 实现租户的业务逻辑
  - _需求: 需求1-租户管理_
- [ ] 10. 开发租户Controller
  - 创建`TenantController`类
  - 实现租户管理的RESTful接口
  - _需求: 需求1-租户管理_

## 多租户支持的扩展功能
- [ ] 11. 开发缓存键工具类
  - 创建`CacheKeyUtil`类
  - 实现带租户ID前缀的缓存键生成方法
  - _需求: 需求6-多租户支持的缓存系统_
- [ ] 12. 开发消息队列工具类
  - 创建`MessageUtil`类
  - 实现带租户标识的消息发送方法
  - _需求: 需求7-多租户支持的消息队列_

## 权限控制优化
- [ ] 13. 修改权限校验逻辑
  - 在权限校验中添加租户ID参数
  - 确保用户只能访问其租户内的资源
  - _需求: 需求4-多租户支持的权限控制_

## 日志系统优化
- [ ] 14. 修改日志记录逻辑
  - 在日志记录中添加租户ID字段
  - 支持按租户ID查询和分析日志
  - _需求: 需求5-多租户支持的日志系统_

## 测试与验证
- [ ] 15. 编写单元测试
  - 测试租户上下文管理
  - 测试MyBatis多租户插件
  - 测试租户拦截器
  - _需求: 所有需求_
- [ ] 16. 编写集成测试
  - 测试多租户环境下的数据隔离
  - 测试多租户环境下的权限控制
  - _需求: 所有需求_
- [ ] 17. 性能测试
  - 测试多租户环境下的系统性能
  - 优化SQL查询和索引使用
  - _需求: 所有需求_
# 接口设计文档

## 1. 接口概述

本文档详细描述了Staoo Admin系统的所有API接口设计，包括接口路径、请求方法、请求参数、响应参数等信息。系统采用RESTful API设计风格，所有接口响应均使用统一的Ajax格式。

## 2. 接口通用规范

### 2.1 统一响应格式
所有接口响应均使用以下统一格式：

```json
{
  "code": 200,          // 响应状态码
  "message": "成功",    // 响应消息
  "data": {}
  // 响应数据，根据接口不同而不同
}
```

### 2.2 分页响应格式
列表查询接口的响应数据格式如下：

```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "total": 100,       // 总记录数
    "pageSize": 10,     // 每页记录数
    "pageNum": 1,       // 当前页码
    "list": []          // 数据列表
  }
}
```

### 2.3 状态码规范
- 200：成功
- 400：请求参数错误
- 401：未认证（需要登录）
- 403：未授权（无权限）
- 404：资源不存在
- 500：服务器内部错误

### 2.4 认证方式
- 使用JWT令牌进行认证
- 令牌需要放在请求头的Authorization字段中，格式为：Bearer {token}

## 3. 系统管理模块（system）接口

### 3.1 用户管理接口

#### 3.1.1 查询用户列表
- **接口路径**：/api/system/user/list
- **请求方法**：GET
- **请求参数**：
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | pageNum | Integer | 是 | 当前页码 |
  | pageSize | Integer | 是 | 每页记录数 |
  | username | String | 否 | 用户名（模糊查询） |
  | status | Integer | 否 | 状态（0-禁用，1-启用） |
  | deptId | Long | 否 | 部门ID |
- **响应数据**：
  ```json
  {
    "total": 100,
    "pageSize": 10,
    "pageNum": 1,
    "list": [
      {
        "id": 1,
        "username": "admin",
        "nickname": "管理员",
        "email": "admin@example.com",
        "phone": "13800138000",
        "status": 1,
        "deptId": 1,
        "deptName": "总部",
        "createTime": "2023-01-01 10:00:00",
        "updateTime": "2023-01-01 10:00:00"
      }
    ]
  }
  ```

#### 3.1.2 获取用户详情
- **接口路径**：/api/system/user/{id}
- **请求方法**：GET
- **请求参数**：
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | id | Long | 是 | 用户ID |
- **响应数据**：
  ```json
  {
    "id": 1,
    "username": "admin",
    "nickname": "管理员",
    "email": "admin@example.com",
    "phone": "13800138000",
    "status": 1,
    "deptId": 1,
    "deptName": "总部",
    "roleIds": [1, 2],
    "createTime": "2023-01-01 10:00:00",
    "updateTime": "2023-01-01 10:00:00"
  }
  ```

#### 3.1.3 新增用户
- **接口路径**：/api/system/user
- **请求方法**：POST
- **请求体**：
  ```json
  {
    "username": "test",
    "password": "123456",
    "nickname": "测试用户",
    "email": "test@example.com",
    "phone": "13800138001",
    "status": 1,
    "deptId": 1,
    "roleIds": [2]
  }
  ```
- **响应数据**：成功返回新增用户ID

#### 3.1.4 更新用户
- **接口路径**：/api/system/user
- **请求方法**：PUT
- **请求体**：
  ```json
  {
    "id": 1,
    "nickname": "管理员",
    "email": "admin@example.com",
    "phone": "13800138000",
    "status": 1,
    "deptId": 1,
    "roleIds": [1, 2]
  }
  ```
- **响应数据**：成功返回布尔值

#### 3.1.5 删除用户
- **接口路径**：/api/system/user/{id}
- **请求方法**：DELETE
- **请求参数**：
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | id | Long | 是 | 用户ID |
- **响应数据**：成功返回布尔值

#### 3.1.6 批量删除用户
- **接口路径**：/api/system/user/batch
- **请求方法**：DELETE
- **请求体**：
  ```json
  {
    "ids": [1, 2, 3]
  }
  ```
- **响应数据**：成功返回布尔值

#### 3.1.7 重置用户密码
- **接口路径**：/api/system/user/resetPwd
- **请求方法**：PUT
- **请求体**：
  ```json
  {
    "id": 1,
    "password": "123456"
  }
  ```
- **响应数据**：成功返回布尔值

#### 3.1.8 修改用户状态
- **接口路径**：/api/system/user/changeStatus
- **请求方法**：PUT
- **请求体**：
  ```json
  {
    "id": 1,
    "status": 0
  }
  ```
- **响应数据**：成功返回布尔值

### 3.2 角色管理接口

#### 3.2.1 查询角色列表
- **接口路径**：/api/system/role/list
- **请求方法**：GET
- **请求参数**：
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | pageNum | Integer | 是 | 当前页码 |
  | pageSize | Integer | 是 | 每页记录数 |
  | roleName | String | 否 | 角色名称（模糊查询） |
  | status | Integer | 否 | 状态（0-禁用，1-启用） |
- **响应数据**：分页列表

#### 3.2.2 获取角色详情
- **接口路径**：/api/system/role/{id}
- **请求方法**：GET
- **请求参数**：角色ID
- **响应数据**：角色详情，包含菜单权限和数据权限

#### 3.2.3 新增角色
- **接口路径**：/api/system/role
- **请求方法**：POST
- **请求体**：角色信息，包含菜单权限和数据权限
- **响应数据**：成功返回新增角色ID

#### 3.2.4 更新角色
- **接口路径**：/api/system/role
- **请求方法**：PUT
- **请求体**：角色信息，包含菜单权限和数据权限
- **响应数据**：成功返回布尔值

#### 3.2.5 删除角色
- **接口路径**：/api/system/role/{id}
- **请求方法**：DELETE
- **请求参数**：角色ID
- **响应数据**：成功返回布尔值

#### 3.2.6 批量删除角色
- **接口路径**：/api/system/role/batch
- **请求方法**：DELETE
- **请求体**：角色ID列表
- **响应数据**：成功返回布尔值

#### 3.2.7 获取角色的菜单权限树
- **接口路径**：/api/system/role/menuTree/{roleId}
- **请求方法**：GET
- **请求参数**：角色ID
- **响应数据**：菜单树结构，包含角色已选菜单

### 3.3 部门管理接口

#### 3.3.1 查询部门列表（树形结构）
- **接口路径**：/api/system/dept/tree
- **请求方法**：GET
- **请求参数**：无
- **响应数据**：部门树形结构

#### 3.3.2 获取部门详情
- **接口路径**：/api/system/dept/{id}
- **请求方法**：GET
- **请求参数**：部门ID
- **响应数据**：部门详情

#### 3.3.3 新增部门
- **接口路径**：/api/system/dept
- **请求方法**：POST
- **请求体**：部门信息
- **响应数据**：成功返回新增部门ID

#### 3.3.4 更新部门
- **接口路径**：/api/system/dept
- **请求方法**：PUT
- **请求体**：部门信息
- **响应数据**：成功返回布尔值

#### 3.3.5 删除部门
- **接口路径**：/api/system/dept/{id}
- **请求方法**：DELETE
- **请求参数**：部门ID
- **响应数据**：成功返回布尔值

### 3.4 菜单管理接口

#### 3.4.1 查询菜单列表（树形结构）
- **接口路径**：/api/system/menu/tree
- **请求方法**：GET
- **请求参数**：无
- **响应数据**：菜单树形结构

#### 3.4.2 获取菜单详情
- **接口路径**：/api/system/menu/{id}
- **请求方法**：GET
- **请求参数**：菜单ID
- **响应数据**：菜单详情

#### 3.4.3 新增菜单
- **接口路径**：/api/system/menu
- **请求方法**：POST
- **请求体**：菜单信息
- **响应数据**：成功返回新增菜单ID

#### 3.4.4 更新菜单
- **接口路径**：/api/system/menu
- **请求方法**：PUT
- **请求体**：菜单信息
- **响应数据**：成功返回布尔值

#### 3.4.5 删除菜单
- **接口路径**：/api/system/menu/{id}
- **请求方法**：DELETE
- **请求参数**：菜单ID
- **响应数据**：成功返回布尔值

## 4. 工作流模块（flow）接口

### 4.1 流程定义接口

#### 4.1.1 查询流程定义列表
- **接口路径**：/api/flow/definition/list
- **请求方法**：GET
- **请求参数**：分页参数、流程名称（可选）
- **响应数据**：流程定义分页列表

#### 4.1.2 获取流程定义详情
- **接口路径**：/api/flow/definition/{id}
- **请求方法**：GET
- **请求参数**：流程定义ID
- **响应数据**：流程定义详情

#### 4.1.3 部署流程定义
- **接口路径**：/api/flow/definition/deploy
- **请求方法**：POST
- **请求体**：流程模型数据
- **响应数据**：成功返回部署ID

#### 4.1.4 激活/挂起流程定义
- **接口路径**：/api/flow/definition/changeStatus
- **请求方法**：PUT
- **请求体**：流程定义ID、状态
- **响应数据**：成功返回布尔值

### 4.2 流程实例接口

#### 4.2.1 查询流程实例列表
- **接口路径**：/api/flow/instance/list
- **请求方法**：GET
- **请求参数**：分页参数、流程定义ID（可选）、状态（可选）
- **响应数据**：流程实例分页列表

#### 4.2.2 获取流程实例详情
- **接口路径**：/api/flow/instance/{id}
- **请求方法**：GET
- **请求参数**：流程实例ID
- **响应数据**：流程实例详情、当前任务、流程图等

#### 4.2.3 启动流程实例
- **接口路径**：/api/flow/instance/start
- **请求方法**：POST
- **请求体**：流程定义ID、业务键、变量等
- **响应数据**：成功返回流程实例ID

#### 4.2.4 暂停/激活流程实例
- **接口路径**：/api/flow/instance/changeStatus
- **请求方法**：PUT
- **请求体**：流程实例ID、状态
- **响应数据**：成功返回布尔值

#### 4.2.5 终止流程实例
- **接口路径**：/api/flow/instance/terminate
- **请求方法**：PUT
- **请求体**：流程实例ID、原因
- **响应数据**：成功返回布尔值

### 4.3 任务接口

#### 4.3.1 查询待办任务列表
- **接口路径**：/api/flow/task/todoList
- **请求方法**：GET
- **请求参数**：分页参数、流程实例ID（可选）
- **响应数据**：待办任务分页列表

#### 4.3.2 查询已办任务列表
- **接口路径**：/api/flow/task/doneList
- **请求方法**：GET
- **请求参数**：分页参数、流程实例ID（可选）
- **响应数据**：已办任务分页列表

#### 4.3.3 完成任务
- **接口路径**：/api/flow/task/complete
- **请求方法**：POST
- **请求体**：任务ID、变量、审批意见等
- **响应数据**：成功返回布尔值

#### 4.3.4 转交任务
- **接口路径**：/api/flow/task/delegate
- **请求方法**：POST
- **请求体**：任务ID、转交用户ID
- **响应数据**：成功返回布尔值

#### 4.3.5 认领任务
- **接口路径**：/api/flow/task/claim
- **请求方法**：POST
- **请求体**：任务ID
- **响应数据**：成功返回布尔值

## 5. 表单模块（form）接口

### 5.1 表单设计接口

#### 5.1.1 查询表单模板列表
- **接口路径**：/api/form/template/list
- **请求方法**：GET
- **请求参数**：分页参数、表单名称（可选）
- **响应数据**：表单模板分页列表

#### 5.1.2 获取表单模板详情
- **接口路径**：/api/form/template/{id}
- **请求方法**：GET
- **请求参数**：表单模板ID
- **响应数据**：表单模板详情、JSON结构

#### 5.1.3 保存表单模板
- **接口路径**：/api/form/template/save
- **请求方法**：POST
- **请求体**：表单名称、表单JSON结构等
- **响应数据**：成功返回表单模板ID

#### 5.1.4 更新表单模板
- **接口路径**：/api/form/template/update
- **请求方法**：PUT
- **请求体**：表单模板ID、表单名称、表单JSON结构等
- **响应数据**：成功返回布尔值

#### 5.1.5 删除表单模板
- **接口路径**：/api/form/template/{id}
- **请求方法**：DELETE
- **请求参数**：表单模板ID
- **响应数据**：成功返回布尔值

### 5.2 表单数据接口

#### 5.2.1 查询表单数据列表
- **接口路径**：/api/form/data/list/{templateId}
- **请求方法**：GET
- **请求参数**：表单模板ID、分页参数、查询条件（可选）
- **响应数据**：表单数据分页列表

#### 5.2.2 获取表单数据详情
- **接口路径**：/api/form/data/{id}
- **请求方法**：GET
- **请求参数**：表单数据ID
- **响应数据**：表单数据详情

#### 5.2.3 保存表单数据
- **接口路径**：/api/form/data/save
- **请求方法**：POST
- **请求体**：表单模板ID、表单数据JSON等
- **响应数据**：成功返回表单数据ID

#### 5.2.4 更新表单数据
- **接口路径**：/api/form/data/update
- **请求方法**：PUT
- **请求体**：表单数据ID、表单数据JSON等
- **响应数据**：成功返回布尔值

#### 5.2.5 删除表单数据
- **接口路径**：/api/form/data/{id}
- **请求方法**：DELETE
- **请求参数**：表单数据ID
- **响应数据**：成功返回布尔值

## 6. 认证授权接口

### 6.1 登录
- **接口路径**：/api/auth/login
- **请求方法**：POST
- **请求体**：
  ```json
  {
    "username": "admin",
    "password": "123456"
  }
  ```
- **响应数据**：
  ```json
  {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userInfo": {
      "id": 1,
      "username": "admin",
      "nickname": "管理员",
      "roles": ["admin"]
    }
  }
  ```

### 6.2 登出
- **接口路径**：/api/auth/logout
- **请求方法**：POST
- **请求参数**：无
- **响应数据**：成功返回布尔值

### 6.3 获取当前用户信息
- **接口路径**：/api/auth/info
- **请求方法**：GET
- **请求参数**：无
- **响应数据**：当前用户信息、权限列表等

### 6.4 获取当前用户菜单
- **接口路径**：/api/auth/menu
- **请求方法**：GET
- **请求参数**：无
- **响应数据**：当前用户可访问的菜单树形结构

## 7. 公共接口

### 7.1 上传文件
- **接口路径**：/api/common/upload
- **请求方法**：POST
- **请求参数**：文件（multipart/form-data）
- **响应数据**：文件URL、文件名等

### 7.2 下载文件
- **接口路径**：/api/common/download/{fileId}
- **请求方法**：GET
- **请求参数**：文件ID
- **响应数据**：文件流

### 7.3 获取字典数据
- **接口路径**：/api/common/dict/{dictType}
- **请求方法**：GET
- **请求参数**：字典类型
- **响应数据**：字典数据列表

### 7.4 获取系统参数
- **接口路径**：/api/common/param/{paramKey}
- **请求方法**：GET
- **请求参数**：参数键
- **响应数据**：参数值

## 8. 附录

### 8.1 接口安全要求
- 所有接口必须进行认证和授权校验
- 敏感数据传输必须使用HTTPS
- 接口必须进行请求参数校验
- 接口必须设置合理的限流措施

### 8.2 接口性能要求
- 普通查询接口响应时间应小于500ms
- 复杂查询接口响应时间应小于1000ms
- 写操作接口响应时间应小于800ms
- 接口并发能力应满足业务需求

### 8.3 接口版本控制
- 接口采用URL路径版本控制，如：/api/v1/system/user/list
- 版本升级时应保持向下兼容
- 废弃接口应提前通知并设置合理的过渡期